<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>KPI Dashboard â€“ Firebase SÃ©curisÃ©</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    /* ... (CSS identique Ã  avant, non modifiÃ© pour compacitÃ©) ... */
    /* ... Reprends exactement ton CSS prÃ©cÃ©dent ... */
    :root {
      --main-width: 1100px;
      --main-padding-x: 32px;
      --main-radius: 22px;
      --main-shadow: 0 6px 24px #8ec6f755;
      --header-bg: rgba(255,255,255,0.88);
      --header-padding-x: 34px;
      --header-margin-top: 20px;
      --header-margin-bottom: 12px;
      --header-min-height: 70px;
      --logo-height: 44px;
      --main-gap: 26px;
      --card-padding: 28px 38px 23px 38px;
      --card-radius: 21px;
      --graph-min-height: 350px;
      --graph-max-height: 65vh;
      --graph-margin-top: 12px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #eaf3ff 0%, #f8fafb 100%);
      min-height: 100vh;
      color: #223056;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      background: linear-gradient(135deg, #eaf3ff 0%, #d8e4fa 100%);
      box-shadow: 4px 0 22px #c5d6f7a0;
      border-radius: 0 30px 30px 0;
      min-width: 210px;
      max-width: 240px;
      width: 240px;
      padding: 34px 17px 22px 17px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 100;
    }
    .sb-btn {
      background: linear-gradient(90deg, #eaf3ff 0%, #d8e4fa 100%);
      color: #2574c5;
      border-radius: 19px;
      border: none;
      font-size: 16.5px;
      font-weight: 600;
      margin-bottom: 2px;
      padding: 13px 23px;
      display: flex; align-items: center; gap: 13px;
      cursor: pointer;
      transition: box-shadow 0.17s, background 0.18s, color 0.14s;
      outline: none;
      box-shadow: 0 1px 14px #c0d7f7b4;
    }
    .sb-btn.active,
    .sb-btn:focus {
      background: linear-gradient(90deg, #b4d0f6 0%, #eaf3ff 100%);
      color: #0e3b4d;
      box-shadow: 0 3px 18px #8ec6f773;
    }
    .sb-btn:hover {
      background: linear-gradient(90deg, #eaf3ff 0%, #b4d0f6 100%);
      color: #1686c1;
    }
    .header, .main {
      max-width: var(--main-width);
      width: 100%;
      margin: 0 auto;
    }
    .header {
      margin-top: var(--header-margin-top);
      margin-bottom: var(--header-margin-bottom);
      border-radius: var(--main-radius);
      box-shadow: var(--main-shadow);
      background: var(--header-bg);
      backdrop-filter: blur(13px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--header-padding-x);
      min-height: var(--header-min-height);
      position: relative;
      z-index: 20;
      border: 1.2px solid #e6e9ee;
      transition: max-width 0.2s, width 0.2s;
    }
    .header .logos {
      display: flex; align-items: center; gap: 15px;
    }
    .header .logos img {
      height: var(--logo-height);
      border-radius: 11px;
      background: #fff;
      box-shadow: 0 2px 7px #c3def977;
    }
    .header h1 {
      font-size: 23px;
      color: #1686c1;
      flex: 1;
      text-align: center;
      font-weight: 700;
      margin: 0 20px;
      letter-spacing: 0.45px;
      line-height: 1.2;
      word-break: break-word;
    }
    .main {
      padding: 0 var(--main-padding-x) 38px var(--main-padding-x);
      display: flex;
      flex-direction: column;
      gap: var(--main-gap);
      min-height: 100vh;
      box-sizing: border-box;
      transition: max-width 0.2s, width 0.2s, padding 0.2s;
    }
    .main-content {
      margin-left: 240px;
      flex:1; display: flex; flex-direction: column; min-height: 100vh;
    }
    .card.section { display: none; }
    .card.section.active { display: block; margin-top: 0; }
    .card {
      background: rgba(255,255,255,0.92);
      border-radius: var(--card-radius);
      border: 1.4px solid #e6e9ee;
      box-shadow: var(--main-shadow);
      padding: var(--card-padding);
      margin-bottom: 10px;
      transition: box-shadow 0.16s, border 0.14s, padding 0.2s;
      position: relative;
    }
    .card h2 {
      color: #223056;
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 14px;
    }
    .graph-container {
      position: relative;
      min-height: 60vh;
      height: calc(100vh - 270px);
      max-height: 70vh;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #chart, #preview-chart {
      flex: 1 1 auto;
      min-height: var(--graph-min-height);
      height: 100%;
      max-height: var(--graph-max-height);
      background: #eaf3ff;
      border-radius: 13px;
      margin-top: var(--graph-margin-top);
      box-shadow: 0 2px 18px #c0d7f7a6;
    }
    .export-pdf-btn {
      position: absolute;
      top: 18px;
      right: 26px;
      background: linear-gradient(90deg, #eaf3ff 0%, #b4d0f6 100%);
      color: #1686c1;
      border: none;
      border-radius: 9px;
      font-size: 15px;
      font-weight: 600;
      padding: 8px 20px;
      box-shadow: 0 2px 8px #b8c7f733;
      cursor: pointer;
      transition: background 0.18s, color 0.12s;
      z-index: 10;
    }
    .export-pdf-btn:hover {
      background: linear-gradient(90deg, #b4d0f6 0%, #eaf3ff 100%);
      color: #0e3b4d;
    }
    .tableau-kpi {
      width: 100%;
      border-radius: 13px;
      overflow: hidden;
      background: rgba(255,255,255,0.97);
      box-shadow: 0 2px 11px #adc9ee1e;
      margin-top: 6px;
      border: 1.1px solid #e0e0e0;
    }
    .tableau-kpi table {
      border-collapse: collapse;
      width: 100%;
      font-size: 15px;
    }
    .tableau-kpi th, .tableau-kpi td {
      padding: 11px 13px;
      text-align: left;
      border-bottom: 1.1px solid #e3effc;
    }
    .tableau-kpi th {
      background: #eaf3ff;
      color: #2574c5;
      font-weight: 700;
      letter-spacing: 0.08px;
    }
    .tableau-kpi tr:hover { background: #f5faff; }
    .btn-main {
      background: linear-gradient(90deg, #eaf3ff 0%, #b4d0f6 100%);
      color: #2574c5;
      border-radius: 15px;
      border: none;
      font-size: 15.5px;
      font-weight: 600;
      padding: 11px 25px;
      margin-top: 13px;
      box-shadow: 0 2px 8px #b8c7f733;
      cursor: pointer;
      transition: background 0.17s, color 0.13s;
    }
    .btn-main:hover, .btn-main:focus {
      background: linear-gradient(90deg, #b4d0f6 0%, #eaf3ff 100%);
      color: #0e3b4d;
      outline: none;
    }
    .actions-row { display: flex; gap: 12px; align-items: center; }
    .action-btn {
      background: #eaf3ff;
      color: #2574c5;
      border: 1.2px solid #b4d0f6;
      border-radius: 8px;
      padding: 6px 13px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.13s, color 0.12s, border 0.13s;
    }
    .action-btn:hover {
      background: #b4d0f6;
      color: #0e3b4d;
      border: 1.2px solid #1686c1;
    }
    input, select {
      padding:7px;
      border-radius:6px;
      border:1px solid #b4d0f6;
      margin-bottom: 8px;
      font-size: 15px;
    }
    label { margin-top:8px; font-size: 15px; }
    @media (max-width: 1100px) {
      .header, .main {
        max-width: 98vw;
        padding-left: 8px;
        padding-right: 8px;
      }
      .header {
        padding: 0 10px;
      }
    }
    @media (max-width: 900px) {
      .main { padding: 13px 4vw 28px 4vw;}
      .header { flex-direction: column; gap: 6px; }
      .header .logos { gap: 7px; }
      .header h1 { font-size: 18px; margin: 0 6px; }
    }
    @media (max-width: 700px) {
      .sidebar { min-width: 70px; padding: 11px 1px; width: 70px; }
      .main-content { margin-left: 70px !important; }
      .main { padding: 2vw 1vw 20px 1vw; }
      .card { padding: 10px 2vw; }
      .header h1 { font-size: 14px; }
      .header .logos img { height: 25px;}
      .export-pdf-btn { right: 8px; top: 7px; }
      #chart, #preview-chart { min-height: 180px;}
    }
  </style>
</head>
<body>
  <div class="sidebar">
  <button class="sb-btn active" onclick="showSection('graph', this)">ðŸ“Š Vue Graphique</button>
  <button class="sb-btn" onclick="showSection('list', this)">ðŸ“‹ Liste des KPI</button>
  <button class="sb-btn" onclick="showSection('add', this)">âž• Ajouter un KPI</button>
  <button class="sb-btn" id="injectDemoKPI" style="margin-top: 18px; background: #b3e6c1;">âœ¨ Injecter les KPI de dÃ©mo</button>
  <div style="flex:1"></div>
  <div class="logos-side" style="display:flex; flex-direction:column; align-items:center; gap:18px; margin-bottom:8px;">
    <img src="logo-cesi.png" alt="Logo CESI" style="height:38px; border-radius:7px; background:#fff; box-shadow:0 2px 7px #c3def977;">
    <img src="logo-cw.png" alt="Logo C&W" style="height:38px; border-radius:7px; background:#fff; box-shadow:0 2px 7px #c3def977;">
    <img src="logo-meridien.png" alt="Logo Le MÃ©ridien" style="height:38px; border-radius:7px; background:#fff; box-shadow:0 2px 7px #c3def977;">
  </div>
</div>
      <div id="list" class="card section">
        <h2>Liste des KPI</h2>
        <div class="tableau-kpi">
          <table id="kpiTable">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Objectif</th>
                <th>Moyenne</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="add" class="card section">
        <h2>Ajouter ou modifier un KPI</h2>
        <div style="display: flex; flex-direction: column; gap: 7px; max-width:400px;">
          <label for="newKpiName">Nom :</label>
          <input type="text" id="newKpiName" oninput="previewKPI()">
          <label for="newKpiObjectif">Objectif :</label>
          <input type="number" id="newKpiObjectif" oninput="previewKPI()">
          <label for="weekCount">Nombre de semaines :</label>
          <input type="number" id="weekCount" value="6" min="1" max="20" onchange="generateInputs(this.value)">
          <label>Valeurs :</label>
          <div id="newKpiValues" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px;"></div>
          <button class="btn-main" onclick="addNewKPI()">Valider</button>
        </div>
        <div style="margin-top:24px;">
          <h3 style="margin:8px 0 0 0; color:#1686c1;">PrÃ©visualisation</h3>
          <div class="graph-container" style="min-height:unset;height:auto;max-height:unset;">
            <div id="preview-chart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- Firebase, Plotly, html2pdf dÃ©jÃ  chargÃ©s -->
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>KPI Dashboard â€“ Firebase SÃ©curisÃ©</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    :root {
      --main-width: 1100px;       /* Largeur max du contenu principal */
      --main-padding-x: 32px;     /* Padding horizontal */
      --main-radius: 22px;
      --main-shadow: 0 6px 24px #8ec6f755;
      --header-bg: rgba(255,255,255,0.88);
      --header-padding-x: 34px;
      --header-margin-top: 20px;
      --header-margin-bottom: 12px;
      --header-min-height: 70px;
      --logo-height: 44px;
      --main-gap: 26px;
      --card-padding: 28px 38px 23px 38px;
      --card-radius: 21px;
      --graph-min-height: 350px;
      --graph-max-height: 65vh;
      --graph-margin-top: 12px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #eaf3ff 0%, #f8fafb 100%);
      min-height: 100vh;
      color: #223056;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      background: linear-gradient(135deg, #eaf3ff 0%, #d8e4fa 100%);
      box-shadow: 4px 0 22px #c5d6f7a0;
      border-radius: 0 30px 30px 0;
      min-width: 210px;
      max-width: 240px;
      width: 240px;
      padding: 34px 17px 22px 17px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 100;
    }
    .sb-btn {
      background: linear-gradient(90deg, #eaf3ff 0%, #d8e4fa 100%);
      color: #2574c5;
      border-radius: 19px;
      border: none;
      font-size: 16.5px;
      font-weight: 600;
      margin-bottom: 2px;
      padding: 13px 23px;
      display: flex; align-items: center; gap: 13px;
      cursor: pointer;
      transition: box-shadow 0.17s, background 0.18s, color 0.14s;
      outline: none;
      box-shadow: 0 1px 14px #c0d7f7b4;
    }
    .sb-btn.active,
    .sb-btn:focus {
      background: linear-gradient(90deg, #b4d0f6 0%, #eaf3ff 100%);
      color: #0e3b4d;
      box-shadow: 0 3px 18px #8ec6f773;
    }
    .sb-btn:hover {
      background: linear-gradient(90deg, #eaf3ff 0%, #b4d0f6 100%);
      color: #1686c1;
    }
    .logos-side {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      margin-bottom: 8px;
      margin-top: 12px;
    }
    .logos-side img {
      height: 38px;
      border-radius: 7px;
      background: #fff;
      box-shadow: 0 2px 7px #c3def977;
    }
    .main-content {
      margin-left: 240px;
      flex:1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .header, .main {
      max-width: var(--main-width);
      width: 100%;
      margin: 0 auto;
    }
    .header {
      margin-top: var(--header-margin-top);
      margin-bottom: var(--header-margin-bottom);
      border-radius: var(--main-radius);
      box-shadow: var(--main-shadow);
      background: var(--header-bg);
      backdrop-filter: blur(13px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 var(--header-padding-x);
      min-height: var(--header-min-height);
      position: relative;
      z-index: 20;
      border: 1.2px solid #e6e9ee;
      transition: max-width 0.2s, width 0.2s;
    }
    .header h1 {
      font-size: 23px;
      color: #1686c1;
      flex: 1;
      text-align: center;
      font-weight: 700;
      margin: 0 20px;
      letter-spacing: 0.45px;
      line-height: 1.2;
      word-break: break-word;
    }
    .main {
      padding: 0 var(--main-padding-x) 38px var(--main-padding-x);
      display: flex;
      flex-direction: column;
      gap: var(--main-gap);
      min-height: 100vh;
      box-sizing: border-box;
      transition: max-width 0.2s, width 0.2s, padding 0.2s;
    }
    .card.section { display: none; }
    .card.section.active { display: block; margin-top: 0; }
    .card {
      background: rgba(255,255,255,0.92);
      border-radius: var(--card-radius);
      border: 1.4px solid #e6e9ee;
      box-shadow: var(--main-shadow);
      padding: var(--card-padding);
      margin-bottom: 10px;
      transition: box-shadow 0.16s, border 0.14s, padding 0.2s;
      position: relative;
    }
    /* ... le reste de ton CSS inchangÃ© ... */
    /* ... */
  </style>
</head>
<body>
  <div class="sidebar">
    <button class="sb-btn active" onclick="showSection('graph', this)">ðŸ“Š Vue Graphique</button>
    <button class="sb-btn" onclick="showSection('list', this)">ðŸ“‹ Liste des KPI</button>
    <button class="sb-btn" onclick="showSection('add', this)">âž• Ajouter un KPI</button>
    <button class="sb-btn" id="injectDemoKPI" style="margin-top: 18px; background: #b3e6c1;">âœ¨ Injecter les KPI de dÃ©mo</button>
    <div style="flex:1"></div>
    <div class="logos-side">
      <img src="logo-cesi.png" alt="Logo CESI">
      <img src="logo-cw.png" alt="Logo C&W">
      <img src="logo-meridien.png" alt="Logo Le MÃ©ridien">
    </div>
  </div>

  <div class="main-content">
    <div class="header">
      <h1>KPI â€“ Projet de fin dâ€™Ã©tudes | Le MÃ©ridien Ã‰toile</h1>
    </div>
    <div class="main">
      <div id="graph" class="card section active" style="position:relative;">
        <h2>Vue Graphique</h2>
        <label for="kpiSelect">Choisir un KPI :</label>
        <select id="kpiSelect" onchange="updateGraph()"></select>
        <button class="export-pdf-btn" onclick="exportPDF()">ðŸ“¤ Export PDF</button>
        <div class="graph-container">
          <div id="chart"></div>
        </div>
      </div>
      <div id="list" class="card section">
        <h2>Liste des KPI</h2>
        <div class="tableau-kpi">
          <table id="kpiTable">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Objectif</th>
                <th>Moyenne</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="add" class="card section">
        <h2>Ajouter ou modifier un KPI</h2>
        <div style="display: flex; flex-direction: column; gap: 7px; max-width:400px;">
          <label for="newKpiName">Nom :</label>
          <input type="text" id="newKpiName" oninput="previewKPI()">
          <label for="newKpiObjectif">Objectif :</label>
          <input type="number" id="newKpiObjectif" oninput="previewKPI()">
          <label for="weekCount">Nombre de semaines :</label>
          <input type="number" id="weekCount" value="6" min="1" max="20" onchange="generateInputs(this.value)">
          <label>Valeurs :</label>
          <div id="newKpiValues" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 8px;"></div>
          <button class="btn-main" onclick="addNewKPI()">Valider</button>
        </div>
        <div style="margin-top:24px;">
          <h3 style="margin:8px 0 0 0; color:#1686c1;">PrÃ©visualisation</h3>
          <div class="graph-container" style="min-height:unset;height:auto;max-height:unset;">
            <div id="preview-chart"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ... tout le JS inchangÃ© ... -->
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore-compat.js"></script>
  <!-- ... ton script JS ... -->
  <!-- (tout ton JS reste inchangÃ©, copie tout le script comme dans ta version prÃ©cÃ©dente) -->
</body>
</html>





